spring:
  application:
    name: wallet-radar
  data:
    mongodb:
      uri: ${MONGODB_URI:mongodb://localhost:27017/walletradar}

# Unified per-network ingestion config (ADR-012). Batch size semantics: ADR-011.
walletradar:
  ingestion:
    # Backfill window (T-009): blocks from current block. Default ~2 years Ethereum (12s block).
    # L2s use many more blocks per year; set per-network window-blocks so backfill covers ~2 years (e.g. Arbitrum ~4 bl/s → 252M).
    backfill:
      window-blocks: 5256000
      max-retries: 5
      retry-base-delay-minutes: 2
      retry-max-delay-minutes: 60
      retry-scheduler-interval-ms: 120000
    network:
      # If backfill fails with "RPC failed after 5 attempts", public RPCs may be rate-limiting. Try: reduce batch-block-size (e.g. 500), or add a paid RPC URL (Alchemy/Infura) first in urls.
      # Ankr (rpc.ankr.com/eth) works without API key for reasonable request volumes. For heavy usage consider adding an API key.
      ETHEREUM:
        urls:
          - https://eth.llamarpc.com
          - https://ethereum.publicnode.com
          - https://rpc.ankr.com/eth
          - https://eth.drpc.org
        batch-block-size: 2000
      ARBITRUM:
        urls:
          - https://arb1.arbitrum.io/rpc
          - https://arbitrum-one-rpc.publicnode.com
        batch-block-size: 5000
        window-blocks: 252000000   # ~2 years at ~4 blocks/s
      OPTIMISM:
        urls:
          - https://mainnet.optimism.io
          - https://optimism-rpc.publicnode.com
        batch-block-size: 5000
        window-blocks: 252000000   # ~2 years at ~4 blocks/s
      POLYGON:
        urls:
          - https://polygon-bor-rpc.publicnode.com
          - https://polygon.drpc.org
          - https://polygon.llamarpc.com
        batch-block-size: 2000
        window-blocks: 31560000    # ~2 years at ~2s/block
      BASE:
        urls:
          - https://mainnet.base.org
          - https://base.llamarpc.com
          - https://base-rpc.publicnode.com
        batch-block-size: 5000
        window-blocks: 252000000   # ~2 years at ~4 blocks/s
      # Some BSC public RPCs prune old blocks (e.g. "History has been pruned"); multiple endpoints improve retry.
      BSC:
        urls:
          - https://bsc-dataseed.binance.org
          - https://bsc-dataseed1.defibit.io
          - https://bsc-dataseed1.ninicoin.io
          - https://bsc-rpc.publicnode.com
          - https://bsc.drpc.org
        batch-block-size: 2000
        window-blocks: 21024000    # ~2 years at ~3s/block
      AVALANCHE:
        urls:
          - https://api.avax.network/ext/bc/C/rpc
          - https://avalanche-c-chain-rpc.publicnode.com
          - https://avalanche.drpc.org
        batch-block-size: 2000
        window-blocks: 31560000    # ~2 years at ~2s/block
      MANTLE:
        urls:
          - https://mantle-rpc.publicnode.com
          - https://mantle.drpc.org
          - https://rpc.mantle.xyz
        batch-block-size: 2000
        window-blocks: 31560000    # ~2 years at ~2s/block
      SOLANA:
        urls:
          - https://api.mainnet-beta.solana.com
    solana:
      # Max signatures per getSignaturesForAddress call (1-1000). Rate/batch limit.
      signatures-limit: 1000
    # RPC retry: exponential backoff ± jitter. Defaults: base-delay-ms=1000, jitter-factor=0.2, max-attempts=5
    retry:
      # base-delay-ms: 1000
      # jitter-factor: 0.2
      # max-attempts: 5
    # Protocol display name by contract address (EVM) or program id (Solana). Keys lowercase.
    protocol-registry:
      names:  # address (EVM) or program id (Solana) -> display name; lookup is case-insensitive
        "0x7a250d5630b4cf539739df2c5dacb4c659f2488d": "Uniswap V2"
        "0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45": "Uniswap V3"
        "0xe592427a0aece92de3edee1f18e0157c05861564": "Uniswap V3"
        "0x87870bca3f3fd6335c3f4ce8392d69350b4fa4e2": "Aave V3"
  # Pricing: historical and spot resolvers (CoinGecko free API). T-019, T-020.
  pricing:
    coingecko-base-url: https://api.coingecko.com/api/v3
    coingecko-historical-requests-per-minute: 45
    connect-timeout-seconds: 10
    read-timeout-seconds: 15
    # Token contract address (lowercase) -> CoinGecko coin id for /coins/{id}/history and /simple/price
    contract-to-coin-gecko-id:
      "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2": "weth"
      "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee": "ethereum"
      # Native token wrapped addresses for gas cost pricing (FIX-C2)
      "0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270": "matic-network"
      "0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c": "binancecoin"
      "0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7": "avalanche-2"
      "0x78c1b0c915c4faa5fffa6cabf0219da63d7f4cb8": "mantle"
      "So11111111111111111111111111111111111111112": "solana"
